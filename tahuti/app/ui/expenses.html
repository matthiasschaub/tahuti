<!DOCTYPE html>
<html class="dark" lang="en">
  <head>
    <title>Tahuti</title>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1"
    />
    <meta
      name="description"
      content="An Expense Sharing App for Urbit"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Tahuti" />
    <link
      rel="stylesheet"
      href="/apps/tahuti/static/css/min/style.css"
    />
    <link
      rel="stylesheet"
      href="/apps/tahuti/static/css/min/print.css"
      media="print"
    />
    <link
      rel="apple-touch-icon"
      href="https://console.minio.mutualisten.de/api/v1/buckets/public/objects/download?preview=true&prefix=aWNvbi5wbmc=&version_id=null"
    />
    <script src="/apps/tahuti/assets/htmx.js"></script>
    <script src="/apps/tahuti/assets/json-enc.js"></script>
    <script src="/apps/tahuti/assets/path-deps.js"></script>
    <script src="/apps/tahuti/assets/client-side-templates.js"></script>
    <script src="/apps/tahuti/assets/mustache.js"></script>
    <script src="/apps/tahuti/assets/currency.js"></script>
  </head>

  <body>
    <header>
      <nav>
        <ul>
          <!-- hrefs is set by request.js -->
          <li>
            <a href="/apps/tahuti/groups">↜ Groups</a>
          </li>
          <li>
            <a id="expenses-href" href=""><strong>Expenses</strong></a>
          </li>
          <li>
            <a id="balances-href" href="">Balances</a>
          </li>
          <li>
            <a style="opacity: 0.3">Reimbursments</a>
          </li>
          <li>
            <a id="members-href" href="">Members</a>
          </li>
          <li>
            <a id="settings-href" href="">Settings</a>
          </li>
        </ul>
      </nav>
    </header>

    <div hx-ext="client-side-templates,path-deps">
      <div
        hx-get="/"
        hx-trigger="load"
        hx-swap="outerHTML"
        mustache-template="title-template"
      >
        <h2 style="opacity: 0">Loading ...</h2>
      </div>
      <template id="title-template">
        <h2>{{title}}</h2>
      </template>

      <h3>Expenses</h3>
      <div style="overflow-x: auto">
        <table id="expenses">
          <thead>
            <tr>
              <th>For What?</th>
              <th id="amount">Amount</th>
              <th>Paid By</th>
              <th id="date">Date</th>
              <th style="opacity: 0">delete</th>
            </tr>
          </thead>
          <tbody
            id="get-expenses"
            hx-get="/expenses"
            hx-trigger="load,path-deps"
            path-deps="/apps/tahuti/api/groups/*/expenses"
            mustache-template="expenses-template"
          ></tbody>
        </table>
      </div>
      <template id="expenses-template">
        <!-- iterate over array of members object -->
        {{#.}}
        <tr>
          <td>{{title}}</td>
          <td headers="amount">{{amount}}</td>
          <td>{{payer}}</td>
          <td headers="date">{{date}}</td>
          <td>
            <a
              hx-delete="/expenses/{{eid}}"
              hx-confirm="Are you sure?"
              hx-trigger="click"
              hx-swap="none"
              >delete</a
            >
          </td>
        </tr>
        {{/.}}
      </template>
    </div>
  </body>
  <footer>
    <!-- href is set by request.js -->
    <a id="add-href" href="">
      <svg
        id="add-btn"
        width="24px"
        height="24px"
        stroke-width="1.5"
        viewBox="0 0 24 24"
        fill="#fffff3"
        xmlns="http://www.w3.org/2000/svg"
        color="#000000"
      >
        <path
          d="M22 14V8.5M6 13V6a3 3 0 013-3h5M16.992 4h3m3 0h-3m0 0V1m0 3v3M12 21H6a4 4 0 010-8h12a4 4 0 104 4v-3"
          stroke="#000000"
          stroke-width="1.5"
          stroke-linecap="round"
          stroke-linejoin="round"
        ></path></svg
    ></a>
  </footer>
  <script src="/apps/tahuti/assets/request.js"></script>
  <script>
    const USD = (value) => currency(value); // defaults
    const EUR = (value) =>
      currency(value, {
        symbol: "€",
        decimal: ",",
        separator: ".",
        pattern: `# !`,
        fromCents: true,
      });

    const tableBody = document.getElementById("get-expenses");

    // transform values
    //
    tableBody.addEventListener("htmx:afterRequest", (event) => {
      for (const row of tableBody.rows) {
        for (const cell of row.cells) {
          if (cell.headers == "date") {
            const date = new Date(Number(cell.innerText));
            cell.innerText = date.toLocaleDateString();
          }
          if (cell.headers == "amount") {
            cell.innerText = EUR(cell.innerText).format();
          }
        }
      }
    });
  </script>
</html>
