(()=>{var u=document.getElementById("amount"),o=Currency.data(u),p=document.getElementById("put-expenses"),i=document.getElementById("currency"),l=Array.from(document.querySelectorAll(".checkbox")),f=document.getElementById("date");p.addEventListener("htmx:afterSettle",e=>{let t=document.getElementById("group-currency").innerText;l.forEach(n=>{n.addEventListener("click",a=>{l.reduce((s,r)=>s||r.checked,!1)?l.at(-1).setCustomValidity(""):l.at(-1).setCustomValidity("Select at least one.")})}),u.addEventListener("input",n=>{let a=o.getUnmasked();Number.isNaN(parseFloat(a))&&!Number.isFinite(a)?u.setCustomValidity("Please enter a valid amount."):u.setCustomValidity("")}),f.valueAsDate=new Date,fetch("https://api.frankfurter.app/currencies").then(n=>n.json()).then(n=>{for(let[s,r]of Object.entries(n)){var a=document.createElement("option");a.value=s,a.text=s,i.appendChild(a)}i.value=t});let m=t,v=navigator.languages&&navigator.languages.length?navigator.languages[0]:navigator.language;o===!1&&(o=new Currency(u,{maskOpts:{empty:!0,locales:v,options:{style:"currency",currency:m}}})),i.addEventListener("change",n=>{o.opts.maskOpts.options.currency=i.value,u.dispatchEvent(new Event("input",{bubbles:!0}))}),u.addEventListener("input",n=>{let a=document.getElementById("amount"),s=document.getElementById("currency").value,r=document.getElementById("convertedAmount"),g=document.getElementById("break");if(t===s){r.hasAttribute("hidden")||(r.setAttribute("hidden",!0),g.setAttribute("hidden",!0));return}let y=o.getUnmasked();if(y===null||y===0)return;fetch(`https://api.frankfurter.app/latest?amount=${y}&from=${s}&to=${t}`).then(d=>d.json()).then(d=>{r.removeAttribute("hidden"),g.removeAttribute("hidden"),r.dataset.amount=dollarToCents(d.rates[t],t).toString(),r.innerText=`= ${intlCurrencyFormat(d.rates[t],t)}`})})});p.addEventListener("htmx:configRequest",e=>{if("amount"in e.detail.parameters){let c=document.getElementById("group-currency").innerText,m=document.getElementById("currency").value;if(c===m){let v=document.getElementById("amount");var t=dollarToCents(o.getUnmasked(),c).toString()}else var t=document.getElementById("convertedAmount").dataset.amount;e.detail.parameters.amount=t,e.detail.parameters.currency=c}"date"in e.detail.parameters&&(e.detail.parameters.date=new Date(f.value).valueOf()),"involves"in e.detail.parameters&&(Array.isArray(e.detail.parameters.involves)||(e.detail.parameters.involves=[e.detail.parameters.involves]))});p.addEventListener("htmx:afterRequest",e=>{e.detail.successful&&e.detail.elt.id=="put-expenses"&&(window.location.pathname="/apps/tahuti/groups/"+gid()+"/expenses")});})();
