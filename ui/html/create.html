<!doctype html>
<html lang="en">
  <head>
    <title>Group Expenses</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="An Expense Sharing App for Urbit" />
    <meta name="view-transition" content="same-origin" />
    <!-- PWA -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="Tahuti" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <link rel="apple-touch-icon" href="/apps/tahuti/icon180.png" />
    <link rel="icon" href="/apps/tahuti/icon16.png" sizes="16x16" />
    <link
      rel="icon"
      href="/apps/tahuti/tahuti.svg"
      sizes="any"
      type="image/svg+xml"
    />
    <link
      rel="manifest"
      href="/apps/tahuti/manifest.json"
      crossorigin="use-credentials"
    />
    <!-- /PWA -->
    <link rel="stylesheet" href="/apps/tahuti/style.css" />
    <link rel="stylesheet" href="/apps/tahuti/print.css" media="print" />
    <script src="/apps/tahuti/index.js"></script>
    <script src="/apps/tahuti/json-enc.js"></script>
    <script src="/apps/tahuti/client-side-templates.js"></script>
  </head>

  <body hx-boost="true" hx-history="false" hx-indicator="#overlay">
    <header>
      <nav style="opacity: 0; pointer-events: none">
        <ul>
          <li>Groups</li>
          <li>Expenses</li>
          <li>Balances</li>
          <li>Settings</li>
          <li>About</li>
        </ul>
      </nav>
      <div class="header-icon">
        <a href="/apps/tahuti/groups">
          <img class="svg-ico" src="/apps/tahuti/tahuti.svg" />
        </a>
      </div>
    </header>

    <div id="overlay" class="overlay htmx-indicator">
      <img class="spinner" src="/apps/tahuti/circles.svg" />
    </div>

    <h2>Tahuti</h2>

    <h3>Create new group</h3>
    <fieldset>
      <form
        id="put-groups"
        hx-put="/apps/tahuti/api/groups"
        hx-ext="json-enc"
        hx-swap="none"
        hx-vals="js:{gid: self.crypto.randomUUID()}"
        hx-request="noHeaders"
        hx-on::after-request='if(event.detail.successful) window.location.pathname = "/apps/tahuti/groups";'
      >
        <label>Titel</label>
        <br />
        <input
          id="group-title"
          type="text"
          name="title"
          aria-label="Group Title"
          required
        />
        <br />
        <label>Currency</label>
        <br />
        <select
          id="currency"
          type="text"
          name="currency"
          aria-label="Currency"
          required
        ></select>
        <br />
        <label>Access</label>
        <br />
        <select
          id="public"
          type="text"
          name="public"
          aria-label="Public"
          required
        >
          <option value="false">Private</option>
          <option value="true">Public</option>
        </select>
        <br />
        <button class="button-primary" type="submit">Create group â–¸</button>
        <button
          class="button-cancel"
          onclick="window.location.href='/apps/tahuti/groups'"
          type="button"
          value="Cancel"
        >
          Cancel
        </button>
      </form>
    </fieldset>
  </body>
  <script>
    var form = document.getElementById("put-groups");
    form.addEventListener("htmx:configRequest", (event) => {
      console.log(event);
      if ("public" in event.detail.parameters) {
        event.detail.parameters.public =
          event.detail.parameters.public === "true";
        console.log(event.detail.parameters.public === "true");
      }
    });

    // Retrieve all supported currencies and add it to select list
    //
    // Support only currencies which are supported by Frankfurter API.
    // For a unfiltered list use: Intl.supportedValuesOf("currency");
    var select = document.getElementById("currency");
    var host = "api.frankfurter.app";
    fetch(`https://${host}/currencies`)
      .then((resp) => resp.json())
      .then((data) => {
        for (const [key, value] of Object.entries(data)) {
          var option = document.createElement("option");
          option.value = key;
          option.text = key;
          select.appendChild(option);
        }
      });
  </script>
</html>
