<!doctype html>
<html lang="en">
  <head>
    <title>Group Expenses</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="description" content="An Expense Sharing App for Urbit" />
    <!-- PWA -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-title" content="Group Expenses" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <link
      rel="apple-touch-icon"
      href="https://git.sr.ht/~talfus-laddus/tahuti/blob/main/tahuti/app/ui/static/images/icons/180.png"
    />
    <link
      rel="icon"
      href="https://git.sr.ht/~talfus-laddus/tahuti/blob/main/tahuti/app/ui/static/images/icons/16.png"
      sizes="16x16"
    />
    <link
      rel="icon"
      href="https://git.sr.ht/~talfus-laddus/tahuti/blob/main/tahuti/app/ui/static/images/icon.svg"
      sizes="any"
      type="image/svg+xml"
    />
    <link
      rel="manifest"
      href="/apps/tahuti/manifest.json"
      crossorigin="use-credentials"
    />
    <link
      rel="apple-touch-icon"
      href="https://git.sr.ht/~talfus-laddus/tahuti/blob/main/tahuti/app/ui/static/images/icon.svg"
    />
    <!-- /PWA -->
    <link rel="stylesheet" href="/apps/tahuti/css/style.css" />
    <link rel="stylesheet" href="/apps/tahuti/css/print.css" media="print" />
    <script src="/apps/tahuti/js/index.js"></script>
    <script src="/apps/tahuti/js/json-enc.js"></script>
    <script src="/apps/tahuti/js/client-side-templates.js"></script>
  </head>

  <body>
    <header>
      <nav aria-label="Global">
        <ul>
          <li>
            <a href="/apps/tahuti/groups">↜ Groups</a>
          </li>
          <li>
            <a id="expenses-href" href="">Expenses</a>
          </li>
          <li>
            <a id="balances-href" href="">Balances</a>
          </li>
          <li>
            <a id="settings-href" href=""><strong>Settings</strong></a>
          </li>
          <li>
            <a id="about-href" href="">About</a>
          </li>
        </ul>
      </nav>
    </header>

    <div id="overlay" class="overlay htmx-indicator">
      <img class="spinner" src="/apps/tahuti/svg/circles.svg" />
    </div>

    <div
      hx-ext="client-side-templates"
      hx-request="noHeaders"
      hx-indicator="#overlay"
    >
      <div
        hx-get="/"
        hx-trigger="load"
        mustache-template="group-template"
      ></div>
      <template id="group-template">
        <h2>{{title}}</h2>
        <h3>Details</h3>
        <table class="col-two">
          <thead></thead>
          <tbody>
            <tr>
              <th>Title</th>
              <td>{{title}}</td>
            </tr>
            <tr>
              <th>Currency</th>
              <td>{{currency}}</td>
            </tr>
            <tr>
              <th>Host</th>
              <td>{{host}}</td>
            </tr>
          </tbody>
        </table>
      </template>

      <h3>Members</h3>
      <ul>
        <div
          id="get-members"
          hx-get="/members"
          hx-trigger="load"
          hx-swap="outerHTML"
          mustache-template="members-template"
        ></div>
        <template id="members-template">
          {{#.}}
          <li>{{.}}</li>
          {{/.}}
        </template>
        <div
          id="get-invitees"
          hx-get="/invitees"
          hx-trigger="load"
          mustache-template="invitees-template"
        ></div>
        <template id="invitees-template">
          {{#.}}
          <li>{{.}} <small>(invited)</small></li>
          {{/.}}
        </template>
      </ul>

      <fieldset>
        <!-- Action is set by request-group.js -->
        <form id="btn-invite" action="">
          Invite other people on Urbit to this group.
          <br />
          <button class="button-primary" type="submit">Invite people ▸</button>
        </form>
      </fieldset>

      <!-- TODO -->
      <!-- <h3>Leave group</h3> -->
      <!-- <fieldset> -->
      <!--     <!-1- hx-delete="/" -1-> -->
      <!--     <!-1- TODO -1-> -->
      <!--     <form -->
      <!--         id="delete-groups" -->
      <!--         hx-confirm="Are you sure?" -->
      <!--         hx-ext="json-enc" -->
      <!--         hx-swap="none" -->
      <!--         hx-vals="js:{gid: gid()}" -->
      <!--         hx-on::after-request="window.location.pathname = '/apps/tahuti/groups'" -->
      <!--     > -->
      <!--         Leaving this group will not remove any expenses you have been -->
      <!--         involved with. -->
      <!--         <!-1- Group host can not leave a group. -1-> -->
      <!--         <br /> -->
      <!--         <button class="button-cancel" type="submit"> -->
      <!--             Leave this group -->
      <!--         </button> -->
      <!--     </form> -->
      <!-- </fieldset> -->

      <h3>Export expenses</h3>
      <fieldset>
        Download all expenses of this group as JSON.
        <br />
        <button
          class="button-primary"
          onclick="window.location.pathname = '/apps/tahuti/api/groups/' + gid() + '/expenses'"
        >
          Export expenses ▸
        </button>
      </fieldset>

      <h3>Delete group</h3>
      <fieldset>
        <form
          id="delete-groups"
          hx-delete="/"
          hx-confirm="Are you sure?"
          hx-ext="json-enc"
          hx-swap="none"
          hx-vals="js:{gid: gid()}"
          hx-on::after-request="window.location.pathname = '/apps/tahuti/groups'"
        >
          Deleting this group will permanently remove all expenses and members.
          This action can only be performed by the group host.
          <br />
          <button class="button-cancel" type="submit">Delete this group</button>
        </form>
      </fieldset>
    </div>
  </body>

  <script src="/apps/tahuti/js/groups.js"></script>
</html>
